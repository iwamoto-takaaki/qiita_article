---
title: vuexのActionsって何が嬉しいの？
tags:
  - Vue.js
  - Vuex
private: false
updated_at: '2019-03-18T20:45:51+09:00'
id: 32b5cf698e1c18550390
organization_url_name: null
slide: false
ignorePublish: false
---
#はじめに
元社内SEで基幹系とかデータ周りでややこしいのをやってきた私ですが、一念発起してVueの勉強をしています。その中で、「Mutationsで変更を管理するのは判るけど、Actionsって何を書いたら良いの？」的な意見が複数ありました。vueはフロントエンドの技術ですが、私の得意なバックエンド的な発想は違和感がない作りなので、説明してみます。(ご意見歓迎！)

もちろんActionsを使わなくても問題が無いのですが、ある種の問題の解決策になります。

#Vuexのstoreの仕組み
まず、[Vuexのページ](https://vuex.vuejs.org/ja/)にあるのが下の図です。
![vuex.png](https://qiita-image-store.s3.amazonaws.com/0/310093/b9a15cb2-d272-53a2-f93a-6bceea6e6418.png)

わかり易い図ではありますが、この図を見るとVueでStoreを作っても問題が無い気がします。おそらくアプリケーションが単純な内は問題になりません。ただし、大きく二つの問題が発生した場合は、Vuexの導入が必要になってくると思われます。

一つは、管理すべきStateが大きくなりすぎて、stateを変更するmethodが増えすぎた場合です。Modulesを使ってstateを関心事ごとに分割すれば、Mutationsの中身は複雑にならずに済みます。

もう一つは、今回の投稿の目的であるActionsの有用性に関する点です。ActionsはBackend APIと点線で書かれているのは必ずしもやり取りが行われるわけではないことを示していると思われます。しかし、それを含めて一切を調整してくれるのがActionsの機能だと考えています。

#Stateの役割
ちょっと回りくどいですが、Stateについて話します。

たいていのSSR(サーバサイドレンダリング)のサービスの場合は、サーバにDB(データベース)などのデータストアがあります。表示に必要なだけのデータをDBから取得してHTMLを作成します。データに変更がある場合は、サーバにリクエストを送り結果をHTMLで受け取ります。
![store.JPG](https://qiita-image-store.s3.amazonaws.com/0/310093/cad37e67-48dd-8331-01b5-4356e3515fc4.jpeg)

一方、vueで行われているSPA(シングルページアプリケーション)の場合は、最初に表示のため必要なものすべてをHTMLとJavaScripterで受け取った後、データをBlackend APIから取得します。その後のクライアントの操作によってのやり取りは、最小限のデータに限られます。

vueでは、そのために必要なデータをStoreにため込んでいます。

知っておいてほしいのですが、BackendのDBとStoreでは、保持するデータは同じでも表現がまるで違います。Backendでは履歴も含めて永続的にデータを保管する必要があり、Storeは表示やBackendにデータを送る際の必要最低限のデータしかいらないので違ってくるのです。さらにややこしくなりますが、APIのインターフェイスの表現も同一とは限りません。できれば同じであってほしいのですが、サービスを維持・発展する段階において避けられない問題だったりします。

#Mutationsの役割
ActionsとStateの間にはMutationsがあります。Stateを直接変更しないルールにすると何がよいでしょうか。それは、Storeのデータの整合性を一括で管理することです。

オブジェクト指向の一般的な話ですが、Componentsが多く、同じデータについての変更をする箇所が複数ある場合、同じようなロジックの記述が複数個所になります。アプリケーションの複雑化によって、変更に際して問題が起こる可能性が高まります。
![mutations1.JPG](https://qiita-image-store.s3.amazonaws.com/0/310093/5206635a-9923-f8c8-d635-eba0dc124c49.jpeg)

変更をStoreに寄せることで、同様のコードが見つかりやすくなりますし、変更に名前が付くことにより、むやみに同様のコードを書くことを抑えることができるようになります。当然、コードも読みやすくなります。
![mutations3.JPG](https://qiita-image-store.s3.amazonaws.com/0/310093/cc93f91a-8979-71e9-bad9-4c3925a6d554.jpeg)




また、最初の図にあるように、Vueの開発ツールであるdevtoolsのと連携ができます。この機能は非常にパワフルで、mutationsの呼び出しの順序とそれによるデータの遷移を知ることができます。

そして、一番大事なことですが、MutationsはStoreを(特別な理由がない限り)、変更することを約束しています。（副作用が無い。)

#Actionの役割
やっとのことで、Actionsの説明に入ります。

Storeの説明で、StoreはBackendのデータをため込む場所であるという説明をしました。また、MutationsはStore無いのデータの整合性を取る役割があると説明しました。だとすれば、Componentsから何か操作があった場合、BackendとStoreのデータの整合性を取るのがActionsの役割です。

Mutationsと同様にComponentsに同様の処理が分散するのを防ぐ目的があります。

Actionsは、必要に応じてBackend APIと通信を行い。結果をMutationsを通じてStoreに反映させます。もちろん、何からのエラーを返した場合は、エラーページにリダイレクトしたり適切な処理をします。

また、ActionsはBackend APIとの通信という重くなるかもしれない処理を行うからか非同期になっています。
Actonsで一番大事なことは、Actionsは(不正な入力などで、)必ずしも望んだ動作をするとは限らないことです。

#まとめ
- Actionsには、BlackendとStoreの整合性を整えるコードを一括管理できるのが嬉しい
- MutationsはStoreに対する操作を約束してくれます。ActionsはMutationsに対する操作を約束しない
- Blackendとのやり取りが複雑でないサービスはActionsを使わなくても問題ない

#終わりに
ネタ晴らし的に言うと、["Vue Mastery"](https://www.vuemastery.com/)で仕入れた情報で構成しています。とはいえ、基本的にサンプルコードから起こした内容です。実際どうゆうコードになるか知りたい人はそちらを見てみると良いと思います。

~~判りずらいと思いますので、後で図を入れます。~~
いいね・コメントいただければ励みになります。
内容の充実のため、質問を歓迎します。

