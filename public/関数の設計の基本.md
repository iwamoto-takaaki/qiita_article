---
title: 関数の設計の基本
tags:
  - ''
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---
# 対象者

- 大きな関数を作っている
- 延々同じ引数をバケツリレーしている
- 上記の指導に苦労しているシニアプログラマ


# やらないこと

- 戻り値の見つけ方
- 命名規則

# はじめに

いつもレビューの際に、関数の分け方としての基本パターンを説明します。

# よくある大きな関数

まず、改善前のコードとして大きな関数を書きましょう。ECサイトなどでユーザーの買い物カートに商品を追加するコードです。
データベースからの呼び出しは関数で抽象化されているものとします。

``` javascript
// ユーザのカートに商品を追加して、合計の注文数を返す関数
function addOderDetail(userId, productId, amount) {
    // userIdの型チェック
    if userId == "" {
        throw new Exception("userIdが空です");
    }

    // userの存在チェック
    if findUser(userId) == null {
        throw new Exception("userIdが存在しませんでした")
    } 

    // productIdの型チェック
    if productId == "" {
        throw new Exception("productIdが空です")
    }

    // amountの型チェック
    if amount < 1 || amount % 1 !== 0 {
        throw new Exception("注文数が正の整数ではありません")
    }

    // 既存の注文をチェック
    const orderDetail = getOrderDetail(userId, productId);
    if orderDetail === null {
        // 新規の注文だったとき
        const newOrderDetail = new {
            id: 0
            userId: userId
            productId: productID
            amount: amount
        };
        const savedOderDetail = InsertOderDetail(newOrderDetail);  
        // savedOderDetailをそのまま帰すのは問題があるものとする
        return {
            id: savedOderDetail.id, 
            amount: savedOderDetail.amount
        }     
    } else {
        // 既存の注文があったとき、数量を追加する
        orderDetail.amount += amount;
        const updatedOserDetail = updateOserDetail(oderDetail);
        // savedOderDetailをそのまま帰すのは問題があるものとする
        return {
            id: updatedOserDetail.id,
            amount: updatedOderDetail.amount
        }
    }
}

```

型チェックなどは簡略化しています。また、UserオブジェクトからOderDtailの一覧を取得できるようになっていないのも簡略化のためです。

このくらいのサイズの関数であれば、問題ないとしている組織も多いかもしれません。その場合は、もう少し長くなってしまっていると仮定してください。

#　引数のバケツリレー

``` javascript
// ユーザのカートに商品を追加して、合計の注文数を返す関数
function addOerdetail(userId, productId, amount) {
    // userIdの型チェック
    if userId == "" {
        throw new Exception("userIdが空です");
    }

    // userの存在チェック
    if findUser(userId) == null {
        throw new Exception("userIdが存在しませんでした")
    } 

    // productIdの型チェック
    if productId == "" {
        throw new Exception("productIdが空です")
    }

    // amountの型チェック
    if amount < 1 || amount % 1 !== 0 {
        throw new Exception("注文数が正の整数ではありません")
    }

    


// 既存の注文をチェック
    const orderDetail = getOrderDetail(userId, productId);
    if orderDetail === null {
        // 新規の注文だったとき
        const newOrderDetail = new {
            id: 0
            userId: userId
            productId: productID
            amount: amount
        };

        // 戻り値に商品名が追加されたときに追加された
        const product = findProduct(productId)
        if product === null {
            throw new Exception("productIdが存在しませんでした")
        }

        const savedOderDetail = InsertOderDetail(newOrderDetail);  

        // savedOderDetailをそのまま帰すのは問題があるものとする
        return {
            id: savedOderDetail.id, 
            productName: product.Name
            amount: savedOderDetail.amount
        }     
    } else {
        // 既存の注文があったとき、数量を追加する
        orderDetail.amount += amount;
        const updatedOserDetail = updateOserDetail(oderDetail);

        // 戻り値に商品名が追加されたときに追加された
        const product = findProduct(productId)
        if product === null {
            throw new Exception("productIdが存在しませんでした")
        }

        // savedOderDetailをそのまま帰すのは問題があるものとする
        return {
            id: updatedOserDetail.id,
            productName: product.Name
            amount: updatedOderDetail.amount
        }
    }
}

```


# よくある関数処理パターン

プログラムというのは基本的に入力・演算・出力の3つでできています。もっと複雑だと考える人もあるとは思いますが、一旦ご容赦願います。

一般的に関数は下記のような構造になっていることが多いです。

1. 入力部分
    1. 引数チェック
    1. 関連データ読み込み(データベースなど)
1. 演算部分
    1. 対象データの操作
1. 出力部分
    1. 結果の保存(データベースなど)
    1. 戻り値の編集

``` javascript
function addOrder(productId, amount) result {
    // 引数チェック

}
```

